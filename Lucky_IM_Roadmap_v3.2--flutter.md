

### 🗺️ v6.0 系列剩余作战蓝图 (Remaining Roadmap)

#### 🟢 第一阶段：v6.0.0 扫尾与精细化管控 (Governance Cleanup)

**预估耗时：1 周**
针对目前的群管理基建进行业务闭环：

1. **入群审批系统 (Join Request System)**:
* **后端**: 增加 `chat/group/apply` (用户申请) 和 `chat/group/approve` (管理审批) 接口。
* **前端**: 开发“申请列表”页面，管理员收到 Socket 通知后可进行一键通过/拒绝。


2. **消息转发 (Message Forwarding)**:
* **功能**: 支持消息长按“转发”，弹出合并后的“联系人+群组”选择器。
* **核心**: 转发时需保留原消息的 `meta` 属性（如媒体比例、原作者 ID）。


3. **群组社交化增强**:
* **群二维码**: 在群设置页生成包含 `groupId` 的二维码。
* **成员搜索**: 在成员网格顶部增加本地 Filter，解决 100 人以上大群的查找痛点。



---

#### 🟡 第二阶段：v6.1.0 价值交换系统 (Wallet & Red Envelope)

**预估耗时：3 - 4 周**
Lucky IM 的核心价值提升，引入资金流。

1. **账本核心 (Ledger Engine)**:
* **架构**: 基于 Redis Lua 脚本实现高性能抢红包逻辑，防止超发。
* **安全**: 实现支付密码二级验证与本地生物识别（FaceID/指纹）。


2. **红包交互 (Interaction)**:
* **气泡**: 开发专属红包消息气泡，支持“领取后”状态实时同步。
* **动画**: 微信级红包开启与金币掉落动画。


3. **钱包 UI (Wallet Hub)**:
* **功能**: 余额展示、充值/提现模拟入口、转账历史记录流水。



---

#### 🔴 第三阶段：v6.2.0 多维实时通讯 (WebRTC RTC)

**预估耗时：4 - 6 周**
IM 领域的技术天花板，解决“看得见”的问题。

1. **实时音视频基建 (WebRTC Infra)**:
* **中转**: 搭建 Coturn (STUN/TURN) 服务器，解决 NAT 穿透。
* **信令**: 基于现有的 Socket.io 扩展 `call_offer`、`call_answer` 和 `ice_candidate` 事件。


2. **1v1 通话体验 (The Calling)**:
* **全屏 UI**: 适配不同设备比例的呼叫/应答界面，支持前后台状态切换。
* **保活 (关键)**: 接入 iOS CallKit 与 Android ConnectionService，实现系统级的呼叫唤醒。


3. **多端同步控制**:
* **逻辑**: A 端接听，B 端自动停止振铃；A 端静音，状态需实时反馈给对端。



---

### 🛡️ 架构续篇：后续开发铁律 (New Iron Rules)

为了保持 v6.0.0 积累的优秀基建，后续开发必须遵守以下新增规则：

1. **原子性交易原则**: 红包、转账等涉及金额的操作，后端必须使用数据库事务与分布式锁，前端必须增加本地状态预锁定。
2. **信令/数据隔离原则**: RTC 呼叫信令严禁走普通消息通道，必须通过独立的 `call_event` 分发，避免阻塞正常聊天流。
3. **权限向下兼容原则**: 所有新功能（如发红包、发起视频）必须在 `canManage` 或自定义权限检查器中预留开关，确保护主具备“群内禁用特定功能”的能力。
4. **资源自动回收原则**: RTC 通话结束或超时后，必须在 `dispose` 中显式释放摄像头/麦克风权限及相关线程资源，防止内存溢出。

