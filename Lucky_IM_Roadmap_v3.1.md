


---

# 🚦 Lucky IM Roadmap (Remaining Tasks)

> **🚀 当前阶段**：v3.5 Post-Polish (细节打磨与新功能准备)
> **🎯 核心目标**：补齐视觉细节（群头像），完善状态一致性（列表失败态），准备进军视频/文件发送。

---

## 1. 🛠️ v3.5 剩余打磨 (Immediate Polish)

### 🚧 [P1] 群聊视觉完善 (Group Visuals)

> **现状**：群聊功能已通，但头像目前是默认或单张，缺乏“群”的视觉特征。

* [ ] **群头像合成 (Group Avatar)**:
* **算法**: 实现类似微信的“九宫格”合成逻辑（取群成员前 4-9 人头像拼合成一张图）。
* **缓存**: 合成后的图片需要缓存，避免每次渲染都重新计算。



### 🚧 [P2] 会话列表状态一致性 (List Consistency)

> **现状**：聊天页内有红色感叹号，但退回到列表页看不出来哪条会话发送失败。

* [ ] **列表失败标记**:
* **逻辑**: `ConversationItem` 需监听最后一条消息的 `status`。
* **UI**: 如果 `lastMessage.status == failed`，在最后一条消息预览文案前/后显示红色图标。



---

## 2. 🎬 v3.6 媒体扩展 (Rich Media Expansion)

> **目标**：在图片功能稳固的基础上，引入更复杂的流媒体和文件处理。

### [P3] 视频消息 (Video Message)

> **注**：这是之前移出的功能，现在重新列为待办。

* [ ] **架构扩展**: `AssetManager` 适配 `.mp4` / `.mov`。
* [ ] **发送流程**: 视频选取 -> **获取第一帧做封面** -> 压缩视频 -> 上传封面+视频。
* [ ] **播放体验**: 列表页自动播放/点击全屏播放。

### [P4] 文件消息 (File Message)

* [ ] **通用文件**: 支持 PDF, DOC, ZIP 等非媒体格式。
* [ ] **下载管理**: 实现下载进度条与本地文件打开 (调用系统能力)。

---

## 3. 🔮 v4.0 远期展望 (Advanced Features)

* [ ] **[P5] 音视频通话 (WebRTC)**: 1v1 及多人实时通话。
* [ ] **[P6] 全局搜索 (FTS)**: 本地数据库全文检索 (联系人/聊天记录)。
* [ ] **[P7] 端到端加密 (E2EE)**: Signal Protocol 集成。

---

## 📝 指挥官指令 (Action Plan)


👉 **建议优先级**：
先做 **[P2] 会话列表失败标记**。
**理由**：这是 v3.x 系列的最后一个“体验补丁”。把它做完，v3 系列的**基础体验**就没有任何死角了（不掉消息、有状态反馈、加载丝滑）。然后我们就可以心无旁骛地去搞 **[P3] 视频消息** 这个大工程。

