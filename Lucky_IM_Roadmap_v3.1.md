
---

# 🚦 Lucky IM Roadmap (Next Steps) - Updated v3.6

> **🚀 当前阶段**：v3.6 Initial (多媒体与性能突破)
> **🎯 核心目标**：实现群头像本地合成算法，由“UI 视觉对齐”转向“流媒体能力构建”。

---

## 1. 🎨 v3.6 体验巅峰 (UX & Performance)

### 🚧 [P1] 群聊九宫格头像合成 (Group Avatar Synthesis)

> **现状**：群功能逻辑已满分，UI 布局已对齐微信。目前列表页头像依赖后端或默认图，需改为本地动态合成以达到原生级质感。

* **合成算法**:
* **逻辑**: 自动提取 `ConversationDetail.members` 中的前 9 位（或 4 位）成员头像。
* **绘制**: 利用 `CustomPainter` 或 `ImageEditor` 在内存中完成九宫格拼接。
* **缓存策略**: 深度集成 `AssetManager`，合成图持久化存储，仅在成员增减时触发重绘，确保列表滚动零压力。



---

## 2. 🎬 v3.6 媒体扩展 (Rich Media Expansion)

### [P3] 视频消息 (Video Message)

* **引擎适配**: `AssetManager` 扩展支持 `.mp4` 容器与流式读取。
* **发送全链路**:
* 选取 -> **FFmpeg/Native 提取首帧缩略图** -> 视频分级压缩。
* 双通道上传：优先上传缩略图（秒见预览），后台上传视频原文件。


* **交互表现**:
* 气泡渲染：封面占位 + 居中播放 Icon。
* 全屏沉浸：集成高级播放器，支持进度条拖动与静音切换。



### [P4] 文件消息 (File Message)

* **渲染引擎**: 针对 PDF, DOC, ZIP 等主流格式实现图标自动化匹配。
* **传输管理**: 实现分段下载进度条，调用系统 `Share Sheet` 或 `Open With` 实现跨 App 文件交互。

---

## 3. 🔮 v4.0 远期展望 (Advanced Features)

* **[P5] 音视频通话 (WebRTC)**: 实现 1v1 实时语音/视频对讲。
* **[P6] 全局搜索 (FTS)**: 基于 Sembast 或 SQLite 实现本地消息全量检索。
* **[P7] 端到端加密 (E2EE)**: 集成 Signal Protocol，确保通信隐私。

---

## 📝 指挥官指令 (Action Plan)

**UI 的地基已经打好，现在的 Lucky IM 已经“看起来”像微信了。**

👉 **当前最高优先级**：
**攻克 [P1] 群聊头像合成。**

**理由**：

1. **逻辑闭环**：你刚刚在 `LocalDatabaseService` 里实现了成员列表缓存，这为本地合成头像提供了完美的数据源。
2. **性能优势**：本地合成可以大幅减少网络请求，让你的列表页在离线状态下依然能显示完整的九宫格，真正实现 **Offline-First** 的承诺。

**准备好开启 Canvas 绘图之旅了吗？** 🎨