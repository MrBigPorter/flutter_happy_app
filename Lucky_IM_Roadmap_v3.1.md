收到，大哥！我的错，废话太多了。

**只有计划，没有历史。**

我把你刚才要求的**“视频鲁棒性优化”**（P0）和现在的**“功能扩张”**（P1+）合并成了一份**纯粹的执行计划表**。

这是最干净的版本：

---

# 🚦 Lucky IM Roadmap - v3.8 Master Plan

> **🚀 核心战略**：**先修内功 (视频硬化)，再练招式 (功能扩张)。**
> **🎯 目标**：确保视频发得出去、看不卡顿；同时补齐文件、位置等更多入口。

---

## 1. 🚨 [P0] 核心战役：视频硬化 (Video Hardening) —— **优先级最高**

> **痛点**：当前视频发送脆弱，大文件易 OOM，弱网易失败。

### 🛠️ [P0-1] 智能压缩策略 (Smart Compression)

* **动态参数**: 拒绝无脑 `Default`。根据原视频 `width/height/bitrate` 动态计算压缩参数。
* **分级处理**:
* `> 1080p`: 强制 Resize 到 1080p。
* `> 50MB`: 降低码率。
* `< 10MB`: **跳过压缩**（直传，保画质）。


* **熔断机制**: 超大文件（如 >500MB）直接拦截提示不支持。

### 🛠️ [P0-2] 传输可靠性 (Upload Reliability)

* **大文件拦截**: 配合后端限制，前端先行校验。
* **进度条修正**: 将 `Compression` (压缩) + `Upload` (上传) 的进度合并展示，拒绝假进度。
* **超时重试**: 简单的自动重试机制。

---

## 2. 📂 [P1] 功能扩张 (Feature Expansion) —— **紧随其后**

### 🚧 [P1] 更多菜单 (Plus Menu / Action Sheet)

> **目标**：为文件、位置提供统一入口。

* **UI 重构**: 点击 `+` 弹出仿微信/Messenger 的 **Grid BottomSheet**。
* **功能收纳**: 聚合 相册、相机、视频、文件、位置 5 大入口。
* **动画**: 丝滑的弹出/收起动画。

### 🚧 [P2] 文件消息 (File Message)

> **目标**：支持发送 PDF, DOC, ZIP, APK 等。

* **UI 表现**: 根据后缀名自动匹配精美图标。
* **发送流程**: 接入 `file_picker` -> 识别元数据 -> 复用 `ChatActionService`。
* **交互**: 气泡内显示下载进度，点击调用 `open_file` 打开。

### 🚧 [P3] 位置消息 (Location Message)

* **静态展示**: 集成地图 SDK 截图接口，显示静态快照。
* **交互**: 点击跳转系统地图导航。

---

## 3. ⚡ [P4] 性能优化 (Optimization)

### 🛠️ 离线头像持久化 (Canvas Caching)

* **逻辑**: 将实时计算的九宫格头像，通过 Canvas 绘制并保存为本地物理 PNG 文件。
* **收益**: 列表滚动 0 计算，纯加载图片，极致流畅。

---

## 4. 🔮 [P5+] 远期展望 (Future)

* **音视频通话 UI**: 呼叫/接听界面、振铃逻辑。
* **全局搜索**: 本地数据库全文本检索。

---

## 📝 执行指令

大哥，这份计划**既包含了你要的视频优化，也包含了更多菜单**。

**我们现在的顺序建议是：**

1. 先做 **[P0-1] 智能压缩**（改 `VideoProcessor`），把视频功能彻底搞稳。
2. 再做 **[P1] 更多菜单**（改 UI），为发文件做准备。

**如果同意，我就直接开始写 `VideoProcessor` 的智能压缩代码了？**