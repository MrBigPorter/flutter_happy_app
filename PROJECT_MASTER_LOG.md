

---

# ğŸ“ Lucky IM Project Master Log v3.6 (Instant-Open Edition)

> **ğŸ”´ çŠ¶æ€æ ¡å‡† (2026-01-27 14:55)**
> **å†å²å¿…é¡»å®Œæ•´ï¼Œæˆ˜ç»©å¿…é¡»ç¡®å‡¿ã€‚**
> **é‡Œç¨‹ç¢‘è¾¾æˆï¼šæœ¬åœ°ä¼˜å…ˆæ¶æ„ (SWR) & å¾®ä¿¡ UI åƒç´ çº§å¯¹é½ & è·¨é¡µé¢é€»è¾‘é—­ç¯**
> **æœ€æ–°æˆ˜ç»©**ï¼šæˆåŠŸä¸Šçº¿äº† **ä¼šè¯è¯¦æƒ…ç§’å¼€ç³»ç»Ÿ**ã€‚é€šè¿‡ `StreamProvider` é…åˆ Sembast çš„ `_detailStore`ï¼Œå®ç°äº†â€œç¼“å­˜å…ˆè¡Œï¼Œç½‘ç»œçƒ­æ›´â€ã€‚
> åŒæ—¶ï¼Œå®Œæˆäº† `GroupProfile` ä¸ `UserProfile` çš„ **WeChat Style ç»Ÿä¸€é‡æ„**ï¼Œå¹¶æ‰“é€šäº†ä»ç§èŠåˆ°å»ºç¾¤çš„ **Pre-Selection (é¢„é€‰ä¸­)** é€»è¾‘ã€‚
> **ğŸŸ¢ å½“å‰ç‰ˆæœ¬ï¼šv3.6 (Local-First + UI Unified)**

---

## 1. ğŸ›¡ï¸ æ¶æ„é“å¾‹ (The Iron Rules - 14 Commandments)

1. **ID å”¯ä¸€æ€§**: å‰ç«¯ç”Ÿæˆ UUIDï¼Œåç«¯é€ä¼ ã€‚
2. **UI é›¶æŠ–åŠ¨**: åˆ©ç”¨ `_sessionPathCache` ç¡®ä¿å‘é€ç¬é—´ UI é™æ­¢ã€‚
3. **å•å‘æ•°æ®æµ**: UI åªå¬ DBã€‚
4. **æ¶ˆæ¯å¹‚ç­‰æ€§**: åŒä¸€ ID åªå¤„ç†ä¸€æ¬¡ã€‚
5. **å­˜å‚¨ç›¸å¯¹åŒ–**: æ•°æ®åº“ä»…å­˜æ–‡ä»¶åï¼Œå¿…è°ƒ `AssetManager`ã€‚
6. **æœ¬åœ°å­—æ®µä¿æŠ¤**: `saveMessage` å¿…é¡» `Merge`ã€‚
7. **Web ä¾èµ–é”æ­»**: `idb_shim: ^2.6.0`ã€‚
8. **æé€Ÿé¢„è§ˆä¼˜å…ˆ**: `MemoryBytes` > `LocalFile` > `Network`ã€‚
9. **èµ„æºå•ä¸€å‡ºå£**: ç¦æ­¢ä¸šåŠ¡å±‚ç›´è¿ IOã€‚
10. **UI/é€»è¾‘åˆ†ç¦»**: çŠ¶æ€ä¸‹æ²‰ `Core`ï¼Œä¸šåŠ¡ç•™ `Feature`ã€‚
11. **å¼‚æ­¥æ ‡å‡†åŒ–**: åˆ—è¡¨çŠ¶æ€å¿…é¡» `when(loading/error/data)`ã€‚
12. **æ¡¥æ¥åŸåˆ™**: é€šè®¯å½•å‘èµ·å¿…é¡»èµ° `Bridge API`ã€‚
13. **äº¤äº’æ‰¿è¯º**: è€—æ—¶å¼¹çª—å¿…é¡»è¿”å› `Future`ï¼Œç”±ç»„ä»¶æ¥ç®¡ Loadingã€‚
14. **SWR é€»è¾‘**: **ç¼“å­˜ä¼˜å…ˆæ¨é€ (`yield cache`)ï¼Œç½‘ç»œå¼‚æ­¥æ›´æ–° (`yield network`)**ï¼Œæœç»è¯¦æƒ…é¡µç™½å±ã€‚

---

## 2. ğŸ—ºï¸ ä»£ç åœ°å›¾ (Code Map - v3.6 Scope)

### A. æ•°æ®æŒä¹…åŒ– (Storage) **[âœ“]**

* `ui/chat/services/database/local_database_service.dart`: **[âœ“] æ–°å¢ `_detailStore**`ï¼Œæ”¯æŒ `ConversationDetail` ç¼“å­˜ä¸æ¸…ç†ã€‚
* `ui/chat/models/conversation.dart`: **[âœ“] åµŒå¥—å¯¹è±¡åºåˆ—åŒ–ä¿®å¤** (`explicitToJson`)ï¼Œæ”¯æŒæšä¸¾/å­—ç¬¦ä¸²åŒå‘æ˜ å°„ã€‚

### B. æ ¸å¿ƒäº¤äº’ä¸æµ (Interaction & Streams) **[âœ“]**

* `ui/chat/providers/conversation_provider.dart`: **[âœ“] `chatDetail` æ”¹é€ ä¸º `StreamProvider**`ï¼Œå®ç° SWR ç­–ç•¥ã€‚
* `ui/chat/pages/group_member_select_page.dart`: **[âœ“] å¤šæ¨¡å¼é€‰äººé€»è¾‘** (æ”¯æŒ `preSelectedId` é¢„é€‰ä¸­)ã€‚

### C. UI è¡¨ç°å±‚ (Presentation) **[âœ“]**

* `ui/chat/pages/group_profile_page.dart`: **[âœ“] å¾®ä¿¡é£æ ¼é‡æ„** (æˆå‘˜ç½‘æ ¼ç½®é¡¶ï¼Œå» Header åŒ–)ã€‚
* `ui/chat/pages/user_profile_page.dart`: **[âœ“] é€»è¾‘å¯¹é½** (æ–°å¢â€œåŠ å·â€å»ºç¾¤å…¥å£)ã€‚

---

## 3. âœ… å®Œæ•´åŠŸèƒ½æ¸…å• (The Grand Checklist)

### ğŸš€ v3.6 æœ¬åœ°ä¼˜å…ˆä¸æ€§èƒ½ (Local-First)

* [âœ“] **[P0] è¯¦æƒ…é¡µç§’å¼€ç³»ç»Ÿ** (æœ¬åœ°ç¼“å­˜ 0ms æ¸²æŸ“)ã€‚
* [âœ“] **[P0] è„ç¼“å­˜é˜²å¾¡** (åŠ è½½ä¸­çŠ¶æ€æ™ºèƒ½æ‹¦æˆªæ—§æ•°æ®é—ªçƒ)ã€‚
* [âœ“] **[P0] åµŒå¥—åºåˆ—åŒ–** (è§£å†³ `ChatMember` ä¸æ”¯æŒç›´æ¥å­˜å…¥ Sembast çš„é—®é¢˜)ã€‚
* [âœ“] **[P1] æ•°æ®åº“å½»åº•æ¸…ç†** (é€€å‡ºç™»å½•æ—¶è”åŠ¨æ¸…ç©ºæ¶ˆæ¯ä¸è¯¦æƒ…ç¼“å­˜)ã€‚

### ğŸ¨ v3.6 å¾®ä¿¡åŒ– UI æ‰“ç£¨ (WeChat Style)

* [âœ“] **[P0] ç¾¤è¯¦æƒ…é¡µé‡æ„** (GridView æˆå‘˜åˆ—è¡¨ä¼˜å…ˆï¼Œèœå•æŠ˜å )ã€‚
* [âœ“] **[P0] ç§èŠè¯¦æƒ…é¡µé‡æ„** (å¿«æ·å»ºç¾¤å…¥å£ï¼ŒUI ä¸ç¾¤è¯¦æƒ…é«˜åº¦ä¸€è‡´)ã€‚
* [âœ“] **[P0] è·¯ç”±å‚æ•°ç©¿é€** (é€šè¿‡ `preSelectedId` å®ç°è·¨é¡µé¢çŠ¶æ€ä¼ é€’)ã€‚

### ğŸ’ v3.5 ç»†èŠ‚æ‰“ç£¨ (Polish)

* [âœ“] **[P0] ä¼šè¯åˆ—è¡¨å¤±è´¥æ ‡è®°** (çº¢è‰²æ„Ÿå¹å·â—ï¸ + çŠ¶æ€åŒæ­¥)ã€‚
* [âœ“] **[Refactor] æ¨¡å‹å±‚æšä¸¾é‡æ„** (MessageStatus é›†æˆ)ã€‚

### ğŸ“¸ v3.5 å¤šåª’ä½“æ¶ˆæ¯ (Image Only)

* [âœ“] **[P0] å›¾ç‰‡å‘é€** (ç›¸å†Œé€‰å– / é¢„è§ˆ)ã€‚
* [âœ“] **[P0] æ™ºèƒ½å‹ç¼©** (æ ¹æ®ç½‘ç»œç¯å¢ƒè‡ªåŠ¨å‹ç¼©ä½“ç§¯)ã€‚
* [âœ“] **[P0] æƒé™ç®¡ç†** (Android/iOS ç›¸å†Œæƒé™åŠ¨æ€ç”³è¯·)ã€‚

---

